<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" th:href="@{/css/css/all.css}">
<link rel="stylesheet" th:href="@{/css/stars.css}">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
<script src=" https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js"></script>
<style>
	.note-group-select-from-files {
  		display: none;
	}
</style>
</head>
	<th:block th:replace="~{include/layout :: body(~{this :: main})}">
		<main class="main" th:fragment="main">
			<div class="container">
				<form>
					<input type="hidden" name="user-num" class="form-control" id="user-num" th:value="${userNum}" readonly>				
					<input type="hidden" name="movie-num" class="form-control" id="movie-num" th:value="${movieNum}" readonly>				
					<input type="hidden" name="image" class="form-control" id="image" th:value="${image}" readonly>				
					<div class="form-group">
						<label for="id">아이디</label> 
						<input type="text" name="id" class="form-control" id="id" th:value="${id}" readonly>
					</div>				
					<div class="form-group">
						<label for="movie">영화제목</label> 
						<input type="text" name="movie" class="form-control" id="movie" th:value="${movie}" readonly>
					</div>				
					<div class="form-group">
						<label for="title">리뷰제목</label> 
						<input type="text" name="title" class="form-control" id="title">
						<span id="title-ck"></span>
					</div>
					<div class="form-group">
						<label for="rating">평점</label>
						<input type="number" name="rating" id="rating" class="form-control" step="0.1" max="5" placeholder="평점(0점 - 5점)">
						
						<div class="stars-outer">
							<div class="stars-inner"></div>
						</div>
						<span class="number-rating"></span>
						<br>
						<span id="rating-ck"></span>						
					</div>				
					<div class="form-group">
						<label for="content">내용</label> 
						<textarea class="form-control summernote" id="content"></textarea>
						<span id="content-ck"></span>					
					</div>
				</form>
				<button id="btn-write" class="btn btn-primary">리뷰작성</button>	
			</div>	
			<script>
				$(".summernote").summernote({
					tabsize: 2,
					height: 300,
					minHeight: null,
					maxHeight: null,
					focus: true,
					placeholder: "최대 5000자까지 쓸 수 있습니다.",
					/*callbacks: {
						onImageUpload: function(files, editor, welEditable) {
							for(var i = files.length - 1; i >= 0; i--){
								uploadSummernoteImageFile(files[i], this);
							}
						},
						onPaste: function (e) {
							var clipboardData = e.originalEvent.clipboardData;
							if (clipboardData && clipboardData.items && clipboardData.items.length) {
								var item = clipboardData.items[0];
								if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
									e.preventDefault();
								}
							}
						}				
					}*/
				});				
				
			//	$(".summernote").code("#content");

				/*function uploadSummernoteImageFile(file, editor) {
					data = new FormData();
					data.append("file", file);
					$.ajax({
						data: data,
						type: "POST",
						url: "/recmv/api/rev/uploadSummernoteImageFile",
						contentType: false,
						enctype: "multipart/form-data",
						processData: false,
						success: function(data) {
							console.log(data);
							$(editor).summernote("insertImage", data.url);
						}
					});
				}
				*/
				document.addEventListener("DOMContentLoaded", getRating);		
			  
			  	const maxRating = 5;
			  	const rating = document.getElementById("rating");
			  
			  	rating.addEventListener("blur", (e) => {
					const ratingVal = e.target.value;
				  
				  	if(ratingVal > 5 || ratingVal < 0) {
					  	alert("평점은 0점 이상 5점 이하입니다.");
					  	return;
				  	}
				  
				  	getRating();
			  	});
			  
			  	function getRating() {
			  		const rating = document.getElementById("rating").value;
				  	const starPercentage = (rating / maxRating) * 100;
			  	  	const starPercentageRounded = `${Math.round(starPercentage / 10) * 10}%`;
			  	  
			  	  	document.querySelector(".stars-inner").style.width = starPercentageRounded;
			  	}
			</script>						
		</main>
</html>