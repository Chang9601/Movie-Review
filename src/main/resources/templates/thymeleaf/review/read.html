<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link th:href="@{/css/css/all.css}" rel="stylesheet">
<link th:href="@{/css/stars.css}" rel="stylesheet">
<link
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
	rel="stylesheet">
<script>
/* 	if(!!window.performance && window.performance.navigation.type == 2){
		window.location.reload();
		// !!는 변수를 불리언으로 형변환하는 방법
	} */
</script>
</head>
<th:block th:replace="~{include/layout :: body(~{this :: main})}">
	<main class="main" th:fragment="main">
		<div class="container">
			<input type="hidden" name="id" id="id" th:value="${review.id}"> 				
			<div class="form-group">
				아이디: <span th:text="${review.user.username}"></span>
			</div>
			<div class="form-group">
				영화: <span th:text="${review.movie.title}"></span>
			</div>
			<div class="form-group">
				제목: <span th:text="${review.title}"></span>
			</div>
			<div class="form-group">
				평점:
				<div class="stars-outer">
					<div class="stars-inner"></div>
				</div>
				(<span class="number-rating"></span>)
			</div>
			<div class="form-group">
				내용:
				<div th:utext="${review.content}"></div>
			</div>
			<button class="btn btn-secondary" onclick="history.back()">돌아가기</button>
 			<span th:if="${#authentication.name == review.user.username} or ${#authentication.name == 'admin'}">
				<a th:href="@{/reviews/{id}/update(id=${review.id})}" class="btn btn-warning">리뷰수정</a>
				<button type="button" id="btn--review--delete" class="btn btn-danger">리뷰삭제</button>
			</span> 
			
			<span th:unless="${#authentication.name == review.user.username} or ${#authentication.name == 'admin'}">
				<button id="btn-like-rev" class="btn btn-success">추천하기</button>
			</span>
			<hr />
			
			<div class="card">
				<div class="card-header bi bi-chat-right-dots" >댓글</div>
				<ul id="reply-box" class="list-group-flush"><!-- 
					<th:block th:each="comment : ${review.comment}">
						<li id="reply-${reply.id }" class="list-group-item d-flex justify-content-between">
							<div>${reply.content }</div>
							<div class="d-flex">
								<div class="font-italic">
									글쓴이: <span th:text="${comment.user.username}"></span>
								</div>
								<button onClick="index.replyDelete(${board.id}, ${reply.id })" class="badge">삭제</button>
							</div>
						</li>				
					</th:block> -->
				</ul>
			</div>
			
			<br />	
								
			<div class="card" sec:authorize-expr="isAuthenticated()">
				<div class="card-header bi bi-chat-right-dots">댓글 작성하기</div>
				<form role="form" th:action="@{/api/reviews/{id}/comments(id=${review.id})}" method="post" modelAttribute="commentDto">
					<input type="hidden" name="review--id" id="review--id" th:value="${review.id}"> 					
					<div class="card-body">
						<textarea name="content" id="content" class="form-control" rows="1"></textarea>
					</div>
					<div class="card-footer">
						<button type="button" id="btn--comment--create" class="btn btn-outline-primary bi bi-pencil-square">등록</button>
					</div>
				</form>
			</div>
		</div>			
		
		<script th:inline="javascript">
			  	document.addEventListener('DOMContentLoaded', getRating);		
			  
			  	const maxRating = 5;
			  	function getRating() {
			  		const rating = [[${review.rating}]]; 
				  	const starPercentage = (rating / maxRating) * 100;
			  	  	const starPercentageRounded = `${Math.round(starPercentage / 10) * 10}%`;
			  	  	
			  	  	document.querySelector('.stars-inner').style.width = starPercentageRounded;
			  	  	document.querySelector('.number-rating').innerHTML = rating;
			  	}
			</script>
	</main>
</html>